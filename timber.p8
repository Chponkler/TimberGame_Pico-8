pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
-- initsializatsiya
function _init()
  -- parametry igry
  score = 0
  time = 1.0  -- poloska vremeni (ot 0 do 1)
  player_side = "left"  -- pozitsiya drovoseka
  game_over = false
  game_started = false  -- dlya startovogo ekrana

  -- generatsiya dereva
  tree = {}
  for i = 1, 10 do
    add(tree, rnd_branch())
  end
end

-- sluchaynaya generatsiya bloka dereva
function rnd_branch()
  local r = flr(rnd(3))
  if r == 0 then
    return "left"  -- vetka sleva
  elseif r == 1 then
    return "right" -- vetka sprava
  else
    return "none"  -- bez vetki
  end
end

-- obnovlenie igry
function _update()
  if not game_started then
    if btnp(5) then -- knopka x dlya starta igry
      game_started = true
    end
    return
  end

  if game_over then
    if btnp(5) then -- knopka x dlya perezapuska
      _init()
    end
    return
  end

  -- upravlenie igrokom
  if btnp(0) then -- strelnka vlevo
    chop("left")
  elseif btnp(1) then -- strelnka vpravo
    chop("right")
  end

  -- obnovlenie vremeni
  time -= 0.01
  if time <= 0 then
    game_over = true
  end
end

-- deystvie udara
function chop(side)
  player_side = side

  -- proverka stolknoveniya s vetkoy
  if tree[1] == side then
    game_over = true
    return
  end

  -- uvelichenie scheta i vremeni
  score += 1
  time = mid(0, time + 0.1, 1.0)

  -- peredvizhenie dereva vniz
  deli(tree, 1)
  add(tree, rnd_branch())
end

-- risovanie ekrana
function _draw()
  cls()

  if not game_started then
    -- startovy ekran
    print("chop the tree to score!", 16, 40, 7)
    print("avoid the branches!", 24, 50, 7)
    print("press x to start", 28, 70, 8)
    return
  end

  -- risovanie dereva
  for i = 1, #tree do
    local y = 128 - i * 32
    spr(64, 60, y, 4, 4)  -- stvol dereva (32x32, spryt 64)
    if tree[i] == "left" then
      spr(1, 28, y, 4, 4)  -- vetka sleva (32x32)
    elseif tree[i] == "right" then
      spr(1, 92, y, 4, 4, true)  -- vetka sprava (zerkalnirovaniye 32x32)
    end
  end

  -- risovanie drovoseka
  if player_side == "left" then
    spr(9, 30, 96, 4, 4)  -- drovosek sleva (32x32, blizhe k derevu)
  else
    spr(9, 90, 96, 4, 4, true)  -- drovosek sprava (32x32, blizhe k derevu)
  end

  -- interfeys
  print("score: "..score, 4, 4, 7)
  rectfill(4, 10, 4 + time * 120, 14, 8)  -- poloska vremeni

  -- ekran zaversheniya
  if game_over then
    print("game over!", 40, 64, 8)
    print("press x to restart", 20, 74, 7)
  end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000001111000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000011111100000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000670077000000000000000000000000000044ff4400000000000000000000000000000000000000000
007007000000000000000000000000000000000000000776707776000000000000000000000000000ffffff00000000000000000000000000000000000000000
00000000000000000000000000000000000000000000067777777700000000000000000000000000f70ff07f0000000000000000000000000000000000000000
000000000000000000000000000000000000000000066677777777700000007770000000005d5550444ff4440555d50000000000000000000000000000000000
000000000000000000000000000000000000000000666667777777770000067777700000055d555044ffff440555d55000000000000000000000000000000000
000000000000000000000000000000000000000006666666777777770660067777770776555d5550444444440555d55500000000000000000000000000000000
00000000000000000f000000000000000000000000000000000000006677777777777776555d5550444444440555d55500000000000000000000000000000000
00000000000000000f000000000000000000000000000000000000006666677777777760555d5055044444405555d55500000000000000000000000000000000
000000000000000004f00000000000000000000000000000000000000000677770000000555d5505044444405555d55500000000000000000000000000000000
000000005000000000440000000000000000000000000000000000000000007700000000555d5550000000000000d50000000000000000000000000000000000
000000000500000000044000000000000000000000000000000000000000000000000000555d55550770fffffff0d50fff000000000000000000000000000000
000000000554400000004454000000000000000000000000000000000000000000000000555d55550770fffffff0660fff068888000000000000000000000000
000000000000044444444444444400000000000011111111ccccccccdddddddd66666666555d55550770fffffff0660fff068888000000000000000000000000
0000000000044ff555444444444444554555554411111111ccccccccdddddddd66666666555d50550770fffffff0d50fff000000000000000000000000000000
000000000004000000004554455555444444444411111111ccccccccdddddddd66666666555d5500000000000000d50000000000000000000000000000000000
000000000044000000000000000000044544444411111111ccccccccdddddddd66666666555d5555555555555555d55500000000000000000000000000000000
000000000400000000000000000000000554444411111111ccccccccdddddddd66666666555d5555555555555555d55500000000000000000000000000000000
000000000000000000000000000000000000054411111111ccccccccdddddddd66666666555d5555555555555555d55500000000000000000000000000000000
000000000000000000000000000000000000054411111111ccccccccdddddddd66666666555d5555555555555555d55500000000000000000000000000000000
000000000000000000000000000000000000000511111111ccccccccdddddddd66666666555d5555555555555555d55500000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000555d5555555005555555d55500000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000004444444440770444444444000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000001111111111001111111111000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000001111111111111111111111000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000011100000000000011100000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000011000000000000011000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000040000000000000040000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000044400000000000044400000000000000000000000000000000000
04444444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444644444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ff4444444f44444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444f44444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444f44444444444444f44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444f4444444444444ff44440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444f4444444444444f444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444f44444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04f44444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04ff444444444444444444444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f444444444444444444444464f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f444444444444444444444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f444444444444444444444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044446444444444444444f4444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444444444f44444444f40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f44444444f40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444ff40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444f4444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f444444444444444464444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f444444444444444444444444f440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044f4444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444444444444444444f40000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
04444444444444444444444444444440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
